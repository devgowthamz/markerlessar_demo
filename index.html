<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Ad Office - Professional Edition</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
      // Sequence Controller: Starts 2.wav -> Cup Glow & Heartbeat
      AFRAME.registerComponent('sequence-controller', {
        init: function () {
          const audio2 = document.querySelector('#audio2');
          const msg2 = document.querySelector('#msg2');
          const cup = document.querySelector('#coffee-cup');

          this.el.addEventListener('loaded', () => {
            audio2.components.sound.playSound();
            msg2.setAttribute('visible', 'true');
          });

          audio2.addEventListener('sound-ended', () => {
            msg2.setAttribute('visible', 'false');
            cup.emit('startGlow'); 
          });
        }
      });

      // Coffee Logic: Handles Cup Click -> Ads Appear -> Camera Pan
      AFRAME.registerComponent('coffee-logic', {
        init: function () {
          const el = this.el;
          const bgm = document.querySelector('#bgm-coffee');
          const ads = document.querySelectorAll('.coffee-ad');
          const cameraRig = document.querySelector('#camera-rig');
          const clickMsg = document.querySelector('#click-msg');
          
          el.addEventListener('click', function () {
            el.removeAttribute('animation__color');
            el.removeAttribute('animation__heartbeat');
            el.setAttribute('material', 'color', '#ffffff');
            el.setAttribute('scale', '1 1 1');
            bgm.components.sound.playSound();
            
            ads.forEach(ad => {
              ad.setAttribute('visible', 'true');
              ad.classList.add('clickable');
              ad.setAttribute('animation', 'property: scale; from: 0 0 0; to: 1 1 1; dur: 800; easing: easeOutBack');
            });

            clickMsg.setAttribute('visible', 'true');
            cameraRig.setAttribute('animation', { property: 'position', to: '0 1.2 1.2', dur: 3000, easing: 'easeInOutQuad' });
          });
        }
      });

      AFRAME.registerComponent('poster-audio', {
        schema: { clip: {type: 'string'} },
        init: function () {
          this.el.addEventListener('click', () => {
            const soundEntity = document.querySelector('#poster-sound');
            soundEntity.setAttribute('sound', 'src', this.data.clip);
            soundEntity.components.sound.stopSound();
            soundEntity.components.sound.playSound();
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene shadow="type: pcfsoft" cursor="rayOrigin: mouse" sequence-controller>
      
      <a-assets>
        <img id="floorTex" src="https://i.imgur.com/7b7X8O7.jpg" crossorigin="anonymous">
        <audio id="src2" src="2.wav"></audio>
        <audio id="src4" src="4.wav"></audio>
        <img id="ad1" src="https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=600" crossorigin="anonymous">
        <img id="ad2" src="https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=600" crossorigin="anonymous">
      </a-assets>

      <a-entity id="audio2" sound="src: #src2; autoplay: true"></a-entity>
      <a-entity id="bgm-coffee" sound="src: #src4; loop: true; volume: 0.4"></a-entity>
      <a-entity id="poster-sound" sound="volume: 1"></a-entity>

      <a-entity id="camera-rig" position="0 0 -2">
        <a-camera look-controls wasd-controls="acceleration: 15">
          <a-cursor color="#FF0000" raycaster="objects: .clickable"></a-cursor>
          <a-text id="msg2" visible="false" value="Coffee Time â˜•" position="0 0 -1" align="center" width="3" color="#FFFFFF"></a-text>
          <a-text id="click-msg" visible="false" value="Click a poster to learn more" position="0 0.6 -1" align="center" width="2.5" color="#00FF00"></a-text>
        </a-camera>
      </a-entity>

      <a-plane position="0 0 0" rotation="-90 0 0" width="12" height="12" src="#floorTex" repeat="4 4"></a-plane>
      <a-sky color="#111"></a-sky>
      
      <a-box position="0 2.5 -5" width="12" height="5" depth="0.1" color="#2c3e50"></a-box> 
      <a-box position="-6 2.5 0" width="0.1" height="5" depth="12" color="#95a5a6"></a-box> 
      <a-box position="6 2.5 0" width="0.1" height="5" depth="12" color="#95a5a6"></a-box> 

      <a-plane class="coffee-ad" visible="false" position="0 2.8 -4.9" width="3.5" height="2" src="#ad1" poster-audio="clip: 2.wav"></a-plane>
      
      <a-entity position="-5.9 2.5 0" rotation="0 90 0">
        <a-plane class="coffee-ad" visible="false" position="-2 0 0" width="2" height="2.5" src="#ad2" poster-audio="clip: 6.wav"></a-plane>
        <a-plane class="coffee-ad" visible="false" position="2 0 0" width="2" height="2.5" src="#ad1" poster-audio="clip: 7.wav"></a-plane>
      </a-entity>

      <a-entity position="5.9 2.5 0" rotation="0 -90 0">
        <a-plane class="coffee-ad" visible="false" position="-2 0 0" width="2" height="2.5" src="#ad1" poster-audio="clip: 8.wav"></a-plane>
        <a-plane class="coffee-ad" visible="false" position="2 0 0" width="2" height="2.5" src="#ad2" poster-audio="clip: 9.wav"></a-plane>
      </a-entity>

      <a-entity id="desk-group" position="0 0 -3.5">
        <a-box position="0 0.75 0" width="3.5" height="0.1" depth="1.5" color="#4B2C20"></a-box>
        
        <a-entity id="keyboard" position="0 0.82 0.3">
            <a-box width="0.8" height="0.03" depth="0.3" color="#222"></a-box> 
            <a-box width="0.75" height="0.01" depth="0.25" position="0 0.02 0" color="#333"></a-box> 
        </a-entity>

        <a-entity id="monitor" position="0 1.3 -0.5">
            <a-box width="1.8" height="0.9" depth="0.05" color="#111"></a-box> 
            <a-plane position="0 0.05 0.03" width="1.7" height="0.75" color="#000">
                <a-text value="SYSTEM IDLE\nWAITING FOR BREAK..." align="center" width="2" position="0 0 0.01"></a-text>
            </a-plane>
        </a-entity>
        
        <a-entity id="coffee-cup" position="0.8 0.85 0.2" coffee-logic class="clickable"
                  animation__color="property: material.color; type: color; from: #ffffff; to: #FFFF00; dur: 600; dir: alternate; loop: true; startEvents: startGlow"
                  animation__heartbeat="property: scale; from: 1 1 1; to: 1.15 1.15 1.15; dur: 400; dir: alternate; loop: true; startEvents: startGlow">
            <a-cylinder radius="0.05" height="0.15" color="#ffffff"></a-cylinder> 
            <a-torus radius="0.035" radius-tubular="0.006" arc="180" rotation="0 0 -90" position="0.05 0 0" color="#ffffff"></a-torus> 
            <a-cylinder radius="0.045" height="0.01" position="0 0.07 0" color="#4b3621"></a-cylinder> 
        </a-entity>
      </a-entity>

      <a-light type="ambient" color="#fff" intensity="0.9"></a-light>
    </a-scene>
  </body>
</html>
